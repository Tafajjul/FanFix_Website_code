package pages;

import java.awt.AWTException;
import java.awt.Robot;
import java.awt.Toolkit;
import java.awt.datatransfer.StringSelection;
import java.awt.event.KeyEvent;
import java.time.Duration;
import java.util.concurrent.TimeUnit;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

public class NewPostPage extends BasePage {

	@FindBy(xpath = "//button[@data-testid='pill-button-new-post-ds']")
    WebElement newPost;
	
    @FindBy(xpath = "//div[@data-testid=\"post-caption-input-c\"]/.//div/.//textarea[@placeholder=\"What's on your mind?\"]")
    WebElement postCaptionField;

    @FindBy(xpath = "//div[@data-testid='media-stack-upload-c']")
    WebElement plusIcon;

    @FindBy(xpath = "//button[@data-testid='pill-button-upload-media-ds']")
    WebElement uploadMediaButton;

    @FindBy(xpath = "//div[@class='filepond--wrapper']/.//div/.//div/.//span[.=' Browse ']")
    WebElement browseButton;

    @FindBy(xpath= "//button[.='Continue']")
    WebElement continueButton;

    
    //select the media and click on add media button
    @FindBy(xpath= "//div[@class='MuiStack-root css-1ex1g4g']/.//div[@class='image-item MuiBox-root css-0'][1]")
    WebElement selectImage;
    
    @FindBy(xpath= "//button[@data-testid='pill-button-add-media-ds']")
    WebElement addMediaButton2;
    
    
    @FindBy(xpath= "(//p[.='Custom'])[1]")
    WebElement customSubs;

    @FindBy(xpath= "(//p[.='Custom'])[2]")
    WebElement customNonSubs;
    
    @FindBy(xpath= "(//input[@id='custom-sub'])[1]")
    WebElement customSubsInput;
  
    @FindBy(xpath= "(//input[@id='custom-sub'])[2]")
    WebElement customNonSubsInput;

    @FindBy(xpath= "//button[@data-testid='pill-button-post-to-profile-ds']")
    WebElement postButton;

    public NewPostPage(WebDriver driver) {
        super(driver);
    }

    public void clickNewPostButton() throws InterruptedException
    {
    	WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//button[@data-testid='pill-button-new-post-ds']")));
        
    	newPost.click();
    	Thread.sleep(3000);
    }
    public void writePostCaption(String caption) throws InterruptedException {
    	postCaptionField.click();
        postCaptionField.sendKeys(caption);
        Thread.sleep(3000);
    }

    public void clickPlusIcon(){
    	JavascriptExecutor ja=(JavascriptExecutor)driver;
    	ja.executeScript("arguments[0].scrollIntoView();", plusIcon);
        plusIcon.click();
        uploadMediaButton.click();
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
        WebElement element = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//div[@class='filepond--wrapper']/.//div/.//div/.//span[.=' Browse ']")));
        element.click();
       // ja.executeScript("arguments[0].click();", browseButton);
       // browseButton.click();
    }
    
    public void addMedia(String filePath) throws InterruptedException, AWTException {
        StringSelection upload= new StringSelection(filePath);
		Toolkit.getDefaultToolkit().getSystemClipboard().setContents(upload, null);
		Thread.sleep(3000);
		Robot r= new Robot();
		r.keyPress(KeyEvent.VK_CONTROL);
	    r.keyPress(KeyEvent.VK_V);
	    r.keyPress(KeyEvent.VK_TAB);
	    r.keyPress(KeyEvent.VK_TAB);
	    r.keyPress(KeyEvent.VK_ENTER);
	    r.keyRelease(KeyEvent.VK_CONTROL);
	    r.keyRelease(KeyEvent.VK_V);
	    r.keyRelease(KeyEvent.VK_TAB);
	    r.keyRelease(KeyEvent.VK_TAB);
	    r.keyRelease(KeyEvent.VK_ENTER);
        
       // browseButton.sendKeys(filePath);
	    driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
        continueButton.click();
        Thread.sleep(3000);
    }
    
    public void selectImageToUpload() throws InterruptedException
    {
    	selectImage.click();
    	addMediaButton2.click();
    	Thread.sleep(3000);
    }
    public void clickCustomButton() throws InterruptedException
    {
     customSubs.click();
     customNonSubs.click();
     Thread.sleep(5000);
    }

    public void setCustomPrices(String subscriptionPrice, String nonSubscriptionPrice) throws InterruptedException {
    	
    	customSubsInput.clear();
    	System.out.println("cleared custom subs input");
    	//customSubsInput.click();
    	//System.out.println("clicked custom subs input");
    	customSubsInput.sendKeys(subscriptionPrice);
    	System.out.println("write custom subs input");
    	Thread.sleep(1000);
    	
    	customNonSubsInput.clear();
    	System.out.println("cleared custom NONsubs input");
    	//customNonSubsInput.click();
    	//System.out.println("clicked custom NONsubs input");
    	customNonSubsInput.sendKeys(nonSubscriptionPrice);
    	System.out.println("write custom NONsubs input");
    	Thread.sleep(1000);
    }

	 
    
//verify the post button is disable when the amount is less than 5.
    public boolean isPostButtonEnabled() {
        return postButton.isEnabled();
    }

    public void clickPostButton() {
        postButton.click();
    }
}